<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXPENSE TRACKER</title>
    <style>
        body{
    background-image: url(solid.jpg);
}
h1{
    text-align: center;
    color: rgb(255, 171, 171);
    border: dotted blanchedalmond;
    padding: 15px;
}
fieldset{
    border-radius: 15px;
    border:10px solid white;
    background-color: rgb(141, 218, 207);
    width: 600px;
    float: left;
    padding: 20px;
}
input[type=text]{
    width: 100%;
    margin: 8px 10px;
    border: 1px solid whitesmoke;
    border-radius: 4px;
    text-align: left;
    box-sizing: border-box;
    font-size: 15px;
    padding: 12px 20px
}
input[type=number]{
    width: 100%;
    margin: 8px 10px;
    border: 1px solid whitesmoke;
    border-radius: 4px;
    text-align: left;
    box-sizing: border-box;
    font-size: 15px;
    padding: 12px 20px
}
#seat{
    width: 100%;
    margin: 8px 10px;
    border: 1px solid whitesmoke;
    border-radius: 4px;
    text-align: left;
    box-sizing: border-box;
    font-size: 15px;
    padding: 12px 20px
}
h2{
    text-align: center;
    font-weight: bold;
}
.btn{
    width: 50%;
    margin: 8px;
    border: 1px solid whitesmoke;
    border-radius: 4px;
    text-align: center;
    text-decoration-color: beige;
    box-sizing: border-box;
    font-size: 20px;
    padding: 12px;
    color: black;
    cursor: pointer;
    transform: translate(50%, 10%);

}
.msg{
    margin: 9px;
    background-color: rgb(187, 28, 28);
    color: white;
    font-weight: bold;
}
.Table {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* 2 columns */
    grid-gap: 20px; /* spacing between items */
}

li {
    display: grid;
    grid-template-columns: 1fr; /* 1 column */
    grid-template-rows: repeat(5, auto); /* 5 rows */
    border: 1px solid black;
    padding: 10px;
}
.dlt{
    margin: 2px;
    border: 1px solid white;
    background-color: rgb(16, 218, 218);
    
}
.edit{
    margin: 2px;
    border: 1px solid white;
    background-color: rgb(16, 218, 218);
    
}
.form-group{
    font-weight: bold;
}

    </style>
</head>
<body>
    <main>
        <h1>Expense Tracker for Restaurant</h1>
        <form class="expense">
            <fieldset>
                <h2>Orders</h2>
                <div class="msg"></div>
                <div class="form-group">
                    <label for="price">Choose Price:</label>
                    <input type="number" id="price" class="cost" placeholder="Enter Price">
                </div>
                <div class="form-group">
                    <label for="dish">Choose Dish:</label>
                    <input type="text" id="dish" class="enjoy" placeholder="Enter Dish Name">
                </div>
                <div class="form-group">
                    <label for="seat">Choose a Table:</label>
                    <select name="table" id="seat">
                        <option value="Table1">Table 1</option>
                        
                        <option value="Table2">Table 2</option>
                        
                        <option value="Table3">Table 3</option>
                    </select>
                </div>
                <button type="submit" class="btn">Submit Bill</button>
            </fieldset>
            <ol>
            <li>Table 1</li>
            <ol class="table1"></ol>
            <li>Table 2</li>
            <ol class="table2"></ol>
            <li>Table 3</li>
            <ol class="table3"></ol>
            </ol>
        </form>
    </main>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"></script>
    <script>
        const expenseForm = document.querySelector('.expense');
        expenseForm.addEventListener('submit', Onsubmit);
        window.addEventListener('load', populateList);
        function Onsubmit(e) {
        e.preventDefault();
        const costData = document.querySelector('.cost').value;
        const enjoyDish = document.querySelector('.enjoy').value;
        const tableData = document.querySelector('#seat').value;
        const error = document.querySelector('.msg');
        if (costData == '' || enjoyDish == '' || tableData == ''){
            error.textContent = 'Please fill in all fields.';
            setTimeout(() => {
            error.textContent = '';
            }, 3000);
        } else {
            const billData = {
            price: costData,
            enjoy: enjoyDish,
            table: tableData,
            };
    axios.post('https://crudcrud.com/api/bada9d0e1a6a43589d644aaa43bd4a6c/data', billData)
      .then(function (response) {
        console.log(response);
        const userList = JSON.parse(localStorage.getItem('formData')) || [];
        userList[(response.data)._id] = response.data;
        localStorage.setItem('formData', JSON.stringify(userList));
        if (tableData === 'Table1') {
        registerUser(document.querySelector('.table1'), response.data);
        } else if (tableData === 'Table2') {
        registerUser(document.querySelector('.table2'), response.data);
        }
        else  {
        registerUser(document.querySelector('.table3'), response.data);
        }
      })
      .catch(function (error) {
        document.body.innerHTML = document.body.innerHTML + "<h4> Something went wrong </h4>";
        console.log(error);
      });
  }
}

function populateList() {
    const parent = document.querySelector('.table1');
    axios.get('https://crudcrud.com/api/bada9d0e1a6a43589d644aaa43bd4a6c/data')
      .then(function (response) {
        const userList = response.data || [];
        for (let i = 0; i < userList.length; i++) {
          registerUser(parent,userList[i]);
        }
      })
      .catch(function (error) {
        console.log(error);
      });
  }
  

  function registerUser(parent,billData) {
    const child = document.createElement('li');
    child.innerHTML = `
      <div>
        <p>Cost &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ${billData.price}</p>
        <p>Dish Name &nbsp;&nbsp;&nbsp;&nbsp; - ${billData.enjoy}</p>
        <p>Table Number &nbsp;- ${billData.table}</p>
      </div>
    `;
    parent.appendChild(child);
    const dltBtn = document.createElement('button');
    dltBtn.className = 'dlt';
    dltBtn.innerHTML = 'Delete';
    child.appendChild(dltBtn);

    dltBtn.onclick = () => {
    deleteFormData(billData._id, parent, child);
    }

    function deleteFormData(id, parent, child) {
    axios.delete(`https://crudcrud.com/api/bada9d0e1a6a43589d644aaa43bd4a6c/data/${id}`)
        .then(response => {
        console.log(response);
        parent.removeChild(child);
        
        // Remove item from local storage
        const userList = JSON.parse(localStorage.getItem('formData')) || [];
        delete userList[id];
        localStorage.setItem('formData', JSON.stringify(userList));
        })
        .catch(error => {
        console.log(error);
        })
    }
    const editBtn = document.createElement('button');
    editBtn.className = 'edit';
    editBtn.innerHTML = 'Edit';
    child.appendChild(editBtn);
    editBtn.onclick=()=>{
        createEditButton(billData, parent, child);
    }
  }
  
    function createEditButton(billData, parent, child) {
        parent.removeChild(child);
        document.querySelector('.cost').value = billData.name;
        document.querySelector('.enjoy').value = billData.enjoy;
        document.querySelector('#seat').value = billData.table;

  }
    </script>
</body>
</html>